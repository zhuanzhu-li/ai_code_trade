# 系统架构说明

## 前后端分离架构

本项目采用前后端分离架构，后端提供纯API服务，前端可以独立开发和部署。

## 系统架构图

```
┌─────────────────┐    HTTP/HTTPS    ┌─────────────────┐
│   前端应用      │ ◄──────────────► │   后端API       │
│  (React/Vue/    │    REST API      │  (Flask)        │
│   Angular等)    │                  │                 │
└─────────────────┘                  └─────────────────┘
                                              │
                                              ▼
                                     ┌─────────────────┐
                                     │   MySQL数据库   │
                                     │                 │
                                     └─────────────────┘
```

## 后端架构

### 分层架构

```
┌─────────────────────────────────────┐
│            API层 (routes.py)        │  ← REST API接口
├─────────────────────────────────────┤
│           服务层 (services/)        │  ← 业务逻辑
├─────────────────────────────────────┤
│           模型层 (models/)          │  ← 数据模型
├─────────────────────────────────────┤
│           工具层 (utils/)           │  ← 工具函数
└─────────────────────────────────────┘
```

### 核心模块

1. **API层** (`app/routes.py`)
   - 处理HTTP请求
   - 参数验证
   - 响应格式化
   - 错误处理

2. **服务层** (`services/`)
   - `trading_service.py`: 交易业务逻辑
   - `data_service.py`: 数据获取和处理
   - `risk_service.py`: 风险管理

3. **模型层** (`models/`)
   - 数据库模型定义
   - 数据关系映射
   - 业务方法

4. **策略层** (`strategies/`)
   - 交易策略实现
   - 信号生成
   - 风险控制

## API设计原则

### RESTful设计

- **资源导向**: 每个URL代表一个资源
- **HTTP方法**: GET(查询), POST(创建), PUT(更新), DELETE(删除)
- **状态码**: 使用标准HTTP状态码
- **JSON格式**: 统一使用JSON数据格式

### 认证机制

- **JWT Token**: 无状态认证
- **Token过期**: 24小时有效期
- **自动刷新**: 支持token刷新机制

### 错误处理

```json
{
    "error": "错误描述",
    "code": "ERROR_CODE",
    "details": "详细错误信息"
}
```

## 数据流

### 1. 用户认证流程

```
前端 → POST /api/auth/login → 后端验证 → 返回JWT Token
```

### 2. 交易执行流程

```
前端 → POST /api/trades → 风险检查 → 执行交易 → 更新持仓 → 返回结果
```

### 3. 数据获取流程

```
前端 → GET /api/market-data → 数据服务 → 外部API/数据库 → 返回数据
```

## 安全考虑

### 1. 认证安全
- JWT Token签名验证
- 密码加密存储
- 会话超时机制

### 2. 数据安全
- SQL注入防护
- 输入参数验证
- 敏感数据加密

### 3. 网络安全
- CORS配置
- HTTPS支持
- 请求频率限制

## 扩展性设计

### 1. 水平扩展
- 无状态API设计
- 数据库读写分离
- 负载均衡支持

### 2. 功能扩展
- 插件化策略架构
- 模块化服务设计
- 配置化参数管理

### 3. 监控和日志
- 结构化日志
- 性能监控
- 错误追踪

## 部署架构

### 开发环境
```
开发者 → 本地Flask应用 → 本地MySQL
```

### 生产环境
```
负载均衡器 → 多个Flask实例 → MySQL主从 → 外部数据源
```

## 技术选型理由

### 后端框架: Flask
- **轻量级**: 核心简单，易于理解和扩展
- **灵活性**: 可以根据需求选择组件
- **生态丰富**: 有大量第三方库支持

### 数据库: MySQL
- **成熟稳定**: 经过长期验证
- **性能优秀**: 支持高并发访问
- **生态完善**: 工具和监控方案丰富

### 认证: JWT
- **无状态**: 适合分布式部署
- **标准化**: 广泛支持
- **安全性**: 支持签名验证

## 性能优化

### 1. 数据库优化
- 索引优化
- 查询优化
- 连接池管理

### 2. 缓存策略
- 数据缓存
- 查询结果缓存
- 静态资源缓存

### 3. 异步处理
- 后台任务
- 消息队列
- 批量处理

## 监控和运维

### 1. 健康检查
- API健康检查接口
- 数据库连接检查
- 外部服务检查

### 2. 日志管理
- 结构化日志
- 日志轮转
- 集中收集

### 3. 性能监控
- 响应时间监控
- 错误率监控
- 资源使用监控
